CREATE PROC [dbo].[UPDATENHANVIEN]
@Manhanvien nchar(10),
@Gioitinh nvarchar(3),
@Hoten nvarchar(50),
@ngaysinh date,
@diachi nvarchar(200),
@sodienthoai nvarchar(15),
@chucvu nvarchar(50),
@bangcap nvarchar(50),
@phongban nvarchar(50),
@vitricongviec nvarchar(50)
AS
BEGIN
	DECLARE @Maphongban nvarchar(10)
	SET @Maphongban = (SELECT MaPB FROM PHONGBAN WHERE TenPB = @phongban)
	UPDATE NHANVIEN
	SET GioiTinh = @Gioitinh,
		HoTen = @Hoten,
		NgaySinh = @ngaysinh,
		DiaChi = @diachi,
		SDT = @sodienthoai,
		BangCap = @bangcap,
		MaPB = @Maphongban
	WHERE NHANVIEN.MaNV = @Manhanvien
	IF(@chucvu = N'Không')
	BEGIN
		DELETE FROM NHANVIEN_CHUCVU WHERE MaNV = @Manhanvien
	END
	ELSE
	BEGIN
	DECLARE @Machucvu nchar(10)
	SET @Machucvu = (SELECT CHUCVU.MaCV FROM CHUCVU WHERE TenCV = @chucvu)
	DELETE FROM NHANVIEN_CHUCVU WHERE MaNV = @Manhanvien
	INSERT INTO NHANVIEN_CHUCVU (MaCV, MaNV) VALUES (@Machucvu, @Manhanvien)
	END
	DECLARE @Mavitri nchar(10)
	SET @Mavitri = (SELECT MaVT FROM VITRICONGVIEC WHERE TenVT = @vitricongviec)
	DELETE FROM NHANVIEN_VITRI WHERE MaNV = @Manhanvien
	INSERT INTO NHANVIEN_VITRI (MaVT, MaNV) VALUES (@Mavitri, @Manhanvien)
	IF @@ROWCOUNT > 0 BEGIN RETURN 1 END
	ELSE BEGIN RETURN 0 END;
END


CREATE PROC [dbo].[SELECTNhanVien]
	@manhanvien char(20)
AS
BEGIN
	SELECT 
		HoTen,
		CONVERT(VARCHAR(10),NgaySinh, 103) as NgaySinh,
		GioiTinh,
		NHANVIEN.DiaChi,
		SDT,
		CMTND,
		BangCap,
		DanToc,
		TonGiao,
		CHUCVU.TenCV,
		PHONGBAN.TenPB,
		VITRICONGVIEC.TenVT
	FROM (((NHANVIEN LEFT JOIN (NHANVIEN_VITRI INNER JOIN VITRICONGVIEC ON NHANVIEN_VITRI.MaVT = VITRICONGVIEC.MaVT) ON NHANVIEN.MaNV = NHANVIEN_VITRI.MaNV)
		LEFT JOIN (NHANVIEN_CHUCVU INNER JOIN CHUCVU ON NHANVIEN_CHUCVU.MaCV = CHUCVU.MaCV) ON NHANVIEN.MaNV = NHANVIEN_CHUCVU.MaNV) 
		LEFT JOIN PHONGBAN ON NHANVIEN.MaPB = PHONGBAN.MaPB) WHERE NHANVIEN.MaNV = @manhanvien
END

CREATE PROC  [dbo].[SelectAllNhanVien]
@tukhoa nvarchar (30)
AS
BEGIN

		SELECT MaNV as N'Mã nhân viên', 
		HoTen as N'Họ tên', 
		GioiTinh as N'Giới tính', 
		CONVERT(VARCHAR(10),NgaySinh, 103) as N'Ngày sinh',
		DiaChi as N'Địa chỉ',
		SDT as N'Số điện thoại'
		FROM NHANVIEN WHERE MaNV like '%'+@tukhoa + '%' OR lower(HoTen) like '%'+lower(@tukhoa) + '%' OR SDT like '%'+@tukhoa + '%'
	
END